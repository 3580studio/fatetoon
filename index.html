<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>FATETOON | ë§Œì„¸ë ¥ ê³„ì‚°ê¸°</title>
  <link rel="stylesheet" href="style.css" />
  <script src="script.js" defer></script>
</head>
<body>
  <header>
    <h1>ğŸŒ• FATETOON ë§Œì„¸ë ¥</h1>
    <small>ì‚¬ì£¼ë¥¼ ì‰½ê²Œ, ë§Œì„¸ë ¥ì„ ë§Œí™”ì²˜ëŸ¼</small>
  </header>

  <form id="saju-form">
    <label for="birthdate">ìƒë…„ì›”ì¼ (ì–‘ë ¥)</label>
    <input type="date" id="birthdate" required />

    <label for="birthtime">íƒœì–´ë‚œ ì‹œê°</label>
    <select id="birthtime" required></select>

    <button type="submit">ì‚¬ì£¼ ê³„ì‚°í•˜ê¸°</button>
  </form>

  <div id="result"></div>

  <script>
    /* ===== FATETOON ë§Œì„¸ë ¥ - ìµœì¢…ë³¸ ===== */
    function calculateSaju() {
      const birthStr = document.getElementById("birthdate").value;
      const hourBranchIndex = parseInt(document.getElementById("birthtime").value);
      const resultEl = document.getElementById("result");

      if (!birthStr) {
        resultEl.innerHTML = "âš ï¸ ìƒë…„ì›”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.";
        return;
      }

      const birthDate = new Date(birthStr + "T12:00:00");
      const y = birthDate.getFullYear();
      const m = birthDate.getMonth() + 1;
      const d = birthDate.getDate();

      const stems = ["ê°‘","ì„","ë³‘","ì •","ë¬´","ê¸°","ê²½","ì‹ ","ì„","ê³„"];
      const branches12 = ["ì","ì¶•","ì¸","ë¬˜","ì§„","ì‚¬","ì˜¤","ë¯¸","ì‹ ","ìœ ","ìˆ ","í•´"];

      const adjYear = (m < 2 || (m === 2 && d < 4)) ? y - 1 : y;
      const yearStem = stems[(adjYear - 4) % 10];
      const yearBranch = branches12[(adjYear - 4) % 12];
      const yearGanji = yearStem + yearBranch;

      const boundaries = {2:4,3:6,4:5,5:6,6:6,7:7,8:8,9:8,10:8,11:7,12:7,1:6};
      const monthOrder = {2:0,3:1,4:2,5:3,6:4,7:5,8:6,9:7,10:8,11:9,12:10,1:11};

      let monthBranchIdx;
      if (m === 1 && d < boundaries[1]) monthBranchIdx = 11;
      else {
        const usePrev = (d < boundaries[m]);
        const key = usePrev ? (m > 1 ? m - 1 : 12) : m;
        monthBranchIdx = monthOrder[key];
      }
      const monthBranches = ["ì¸","ë¬˜","ì§„","ì‚¬","ì˜¤","ë¯¸","ì‹ ","ìœ ","ìˆ ","í•´","ì","ì¶•"];
      const monthBranch = monthBranches[monthBranchIdx];

      const yearStemIdx = (adjYear - 4) % 10;
      let tigerStemIdx;
      if (yearStemIdx === 0 || yearStemIdx === 5) tigerStemIdx = 2;
      else if (yearStemIdx === 1 || yearStemIdx === 6) tigerStemIdx = 4;
      else if (yearStemIdx === 2 || yearStemIdx === 7) tigerStemIdx = 6;
      else if (yearStemIdx === 3 || yearStemIdx === 8) tigerStemIdx = 8;
      else tigerStemIdx = 0;

      const monthStem = stems[(tigerStemIdx + monthBranchIdx) % 10];
      const monthGanji = monthStem + monthBranch;

      const dayGanji = getDayGanjiJDN(y, m, d, stems, branches12);
      const dayStemIdx = stems.indexOf(dayGanji[0]);
      const hourStemIdx = (dayStemIdx * 2 + hourBranchIndex) % 10;
      const hourGanji = stems[hourStemIdx] + branches12[hourBranchIndex];

      resultEl.innerHTML = `
        <h3>ğŸŒ• ë‹¹ì‹ ì˜ ì‚¬ì£¼ ê²°ê³¼</h3>
        <p>ë…„ì£¼: ${yearGanji}</p>
        <p>ì›”ì£¼: ${monthGanji}</p>
        <p>ì¼ì£¼: ${dayGanji}</p>
        <p>ì‹œì£¼: ${hourGanji}</p>
      `;
    }

    function getDayGanjiJDN(y, m, d, stems, branches) {
      const jdnBase = JD(1984, 2, 2);
      const j = JD(y, m, d);
      const idx = (j - jdnBase + 2) % 60;
      return stems[idx % 10] + branches[idx % 12];
    }

    function JD(y, m, d) {
      const a = Math.floor((14 - m) / 12);
      const y2 = y + 4800 - a;
      const m2 = m + 12 * a - 3;
      return d + Math.floor((153 * m2 + 2) / 5) + 365 * y2 + Math.floor(y2 / 4)
           - Math.floor(y2 / 100) + Math.floor(y2 / 400) - 32045;
    }

    document.addEventListener("DOMContentLoaded", () => {
      const form = document.getElementById("saju-form");
      form.addEventListener("submit", (e) => {
        e.preventDefault();
        calculateSaju();
      });
      const hourSelect = document.getElementById("birthtime");
      const branches = ["ì","ì¶•","ì¸","ë¬˜","ì§„","ì‚¬","ì˜¤","ë¯¸","ì‹ ","ìœ ","ìˆ ","í•´"];
      branches.forEach((b, i) => {
        const opt = document.createElement("option");
        opt.value = i;
        opt.text = `${b}ì‹œ (${(i * 2) % 24}:00)`;
        hourSelect.appendChild(opt);
      });
    });
  </script>
</body>
</html>
